\documentclass{beamer}
\usepackage[utf8]{inputenc}

\usetheme{Madrid}
\usecolortheme{default}
\usepackage{amsmath,amssymb,amsfonts,amsthm}
\usepackage{txfonts}
\usepackage{tkz-euclide}
\usepackage{listings}
\usepackage{adjustbox}
\usepackage{array}
\usepackage{tabularx}
\usepackage{gvv}
\usepackage{lmodern}
\usepackage{circuitikz}
\usepackage{tikz}
\usepackage{graphicx}

\setbeamertemplate{page number in head/foot}[totalframenumber]

\usepackage{tcolorbox}
\tcbuselibrary{minted,breakable,xparse,skins}



\definecolor{bg}{gray}{0.95}
\DeclareTCBListing{mintedbox}{O{}m!O{}}{%
  breakable=true,
  listing engine=minted,
  listing only,
  minted language=#2,
  minted style=default,
  minted options={%
    linenos,
    gobble=0,
    breaklines=true,
    breakafter=,,
    fontsize=\small,
    numbersep=8pt,
    #1},
  boxsep=0pt,
  left skip=0pt,
  right skip=0pt,
  left=25pt,
  right=0pt,
  top=3pt,
  bottom=3pt,
  arc=5pt,
  leftrule=0pt,
  rightrule=0pt,
  bottomrule=2pt,
  toprule=2pt,
  colback=bg,
  colframe=orange!70,
  enhanced,
  overlay={%
    \begin{tcbclipinterior}
    \fill[orange!20!white] (frame.south west) rectangle ([xshift=20pt]frame.north west);
    \end{tcbclipinterior}},
  #3,
}
\lstset{
    language=C,
    basicstyle=\ttfamily\small,
    keywordstyle=\color{blue},
    stringstyle=\color{orange},
    commentstyle=\color{green!60!black},
    numbers=left,
    numberstyle=\tiny\color{gray},
    breaklines=true,
    showstringspaces=false,
}
%------------------------------------------------------------
%This block of code defines the information to appear in the
%Title page
\title %optional
{1.5.36}
\date{}
%\subtitle{A short story}

\author % (optional)
{Sai Krishna Bakki - EE25BTECH11049}



\begin{document}


\frame{\titlepage}
\begin{frame}{Question}Point P\brak{x,4} lies on the line segment joining the points $\vec{A}$\brak{-5, 8} and $\vec{B}$\brak{4,-10}. Find the ratio in which point P divides the line segment AB. Also, find the value of x.
\end{frame}
\begin{frame}{Theoretical Solution}
Let 
\begin{align}
\vec{A}= \myvec{-5 \\ 8}, \vec{B}= \myvec{4 \\ -10} , \vec{P} = \myvec{x \\ 4}
\end{align}    

Since $\vec{P}$ lies on $\vec{A}$ and $\vec{B}$, they must be collinear
\begin{align}
\therefore \text{rank}\myvec{\vec{P} - \vec{A} & &\vec{B} - \vec{A}} = 1
\end{align}
\begin{align}
    \text{rank}\myvec{x+5 & 9 \\ -4 & -18} = 1
\end{align}
By transformation $R_1 \rightarrow R_1 + \frac{1}{2}R_2$
\begin{align}
    \text{rank}\myvec{x+3 & 0 \\ -4 & -18} = 1
\end{align}
Thus for rank to be 1
\end{frame}
\begin{frame}{Theoretical Solution}
 \begin{align}
    x+3 = 0
\end{align}
\begin{align}
\therefore x = -3
\end{align}
Thus $\vec{P}$ is :
\begin{align}
    \vec{P} = \myvec{-3 \\ 4}
\end{align}

Let $\vec{P} = \lambda\vec{A} + \mu\vec{B}$ with $\lambda + \mu =1$. Using the y-coordinates:

\begin{align}
    \myvec{8 & -10 \\ 1 & 1} \myvec{\lambda \\ \mu} = \myvec{4 \\ 1}
\end{align}
Hence the internal division ratio
\begin{align}
    AP:PB = \mu:\lambda=2:7
\end{align}
\end{frame}

\begin{frame}[fragile]
\frametitle{C Code }
\begin{lstlisting}
#include <stdio.h>

/*
 * Compute AP and PB (vertical distances) and x-coordinate of P (using section formula).
 *
 * Inputs:
 *   Ax, Ay, Bx, By, yP
 *
 * Outputs (via pointers):
 *   *ratio_AP : AP (vertical distance Ay - yP)
 *   *ratio_PB : PB (vertical distance yP - By)
 *   *xP       : x-coordinate of P computed by section formula
 */
void section_point(double Ax, double Ay, double Bx, double By, double yP,
                   double *ratio_AP, double *ratio_PB, double *xP) {
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]
\frametitle{C Code }
\begin{lstlisting}
    double m = Ay - yP;  /* vertical distance AP */
    double n = yP - By;  /* vertical distance PB */

    if (m + n == 0.0) {
        /* degenerate: cannot determine location */
        fprintf(stderr, "Error: m + n == 0, cannot compute section.\n");
        if (ratio_AP) *ratio_AP = 0.0;
        if (ratio_PB) *ratio_PB = 0.0;
        if (xP) *xP = 0.0;
        return;
    }

    if (ratio_AP) *ratio_AP = m;
    if (ratio_PB) *ratio_PB = n;

    /* Section formula for internal division:
       x = (n*Ax + m*Bx) / (m + n)
\end{lstlisting}
\end{frame}
\begin{frame}[fragile]
\frametitle{C Code }
\begin{lstlisting}
       (because AP:PB = m:n, weight on A is n, on B is m)
    */
    if (xP) *xP = (n*Ax + m*Bx) / (m + n);
}
\end{lstlisting}
\end{frame}
\begin{frame}[fragile]
	\frametitle{Python Code through shared output}
	\begin{lstlisting}
#!/usr/bin/env python3
import os
import subprocess
import ctypes
import math
import matplotlib.pyplot as plt

C_FILE = "section.c"
SO_FILE = "./libsection.so"

# Auto-compile if shared lib not present
if not os.path.exists(SO_FILE):
    print("libsection.so not found â€” compiling section.c ...")
    cmd = ["gcc", "-shared", "-o", "libsection.so", "-fPIC", C_FILE]
    try:
        subprocess.run(cmd, check=True)
        print("Compiled libsection.so")
\end{lstlisting}
\end{frame}
\begin{frame}[fragile]
	\frametitle{Python Code through shared output}
	\begin{lstlisting}
    except subprocess.CalledProcessError as e:
        print("Compilation failed:", e)
        raise SystemExit(1)

# Load shared library
lib = ctypes.CDLL(SO_FILE)

# Set function signature:
# void section_point(double, double, double, double, double,
#                    double*, double*, double*)
lib.section_point.argtypes = [ctypes.c_double, ctypes.c_double,
                              ctypes.c_double, ctypes.c_double,
                              ctypes.c_double,
                              ctypes.POINTER(ctypes.c_double),
                              ctypes.POINTER(ctypes.c_double),
                              ctypes.POINTER(ctypes.c_double)]
lib.section_point.restype = None
\end{lstlisting}
\end{frame}
\begin{frame}[fragile]
	\frametitle{Python Code through shared output}
	\begin{lstlisting}
# Input points
Ax, Ay = -5.0, 8.0
Bx, By =  4.0, -10.0
yP = 4.0

# Prepare output holders
ratio_AP = ctypes.c_double()
ratio_PB = ctypes.c_double()
xP = ctypes.c_double()

# Call C function
lib.section_point(Ax, Ay, Bx, By, yP,
                  ctypes.byref(ratio_AP),
                  ctypes.byref(ratio_PB),
                  ctypes.byref(xP))

# Read outputs
m = ratio_AP.value  # AP vertical distance (Ay - yP)
n = ratio_PB.value  # PB vertical distance (yP - By)
\end{lstlisting}
\end{frame}
\begin{frame}[fragile]
	\frametitle{Python Code through shared output}
	\begin{lstlisting}
x_val = xP.value

# Convert ratio to smallest integer ratio (if sensible)
# We'll round to nearest integer then reduce by gcd if both nonzero
def reduced_ratio(a, b):
    ia = int(round(a))
    ib = int(round(b))
    if ia == 0 and ib == 0:
        return (0, 0)
    if ia < 0: ia = -ia
    if ib < 0: ib = -ib
    g = math.gcd(ia, ib) if (ia != 0 and ib != 0) else (ia or ib)
    if g == 0:
        return (ia, ib)
    return (ia // g, ib // g)

ratA_int, ratB_int = reduced_ratio(m, n)
\end{lstlisting}
\end{frame}
\begin{frame}[fragile]
	\frametitle{Python Code through shared output}
	\begin{lstlisting}
print(f" Raw m (AP) = {m}, n (PB) = {n}")
print(f" AP:PB (reduced) = {ratA_int}:{ratB_int}")
print(f" x = {x_val}")

# ---- Plot ----
A = (Ax, Ay)
B = (Bx, By)
P = (x_val, yP)

plt.plot([A[0], B[0]], [A[1], B[1]], linestyle='--', label="Line AB")
plt.scatter(*A, marker='o', label=f"A{A}", zorder=5)
plt.scatter(*B, marker='o', label=f"B{B}", zorder=5)
plt.scatter(*P, marker='o', label=f"P({x_val:.3g},{yP})", zorder=5)

plt.text(A[0]-0.6, A[1]+0.4, f"A{A}", color="red")
plt.text(B[0]+0.4, B[1]-0.6, f"B{B}", color="blue")
\end{lstlisting}
\end{frame}
\begin{frame}[fragile]
	\frametitle{Python Code through shared output}
	\begin{lstlisting}
plt.text(P[0]+0.4, P[1]+0.4, f"P({x_val:.3g},{yP})", color="green")

plt.axhline(0, color="gray", lw=0.5)
plt.axvline(0, color="gray", lw=0.5)
plt.grid(True, linestyle="--", alpha=0.5)
plt.xlabel("x")
plt.ylabel("y")
plt.title(f"P divides AB in ratio {ratA_int}:{ratB_int}")
plt.legend()
plt.gca().set_aspect('equal', adjustable='box')
plt.show()
\end{lstlisting}
\end{frame}
\begin{frame}{Plot by python using shared output from c}
	\begin{center}
		\includegraphics[width=0.9\columnwidth]{figs/Figure.png}
	\end{center}
\end{frame}

\end{document}
